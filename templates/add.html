<html>
<html lang="ko" dir="ltr">

<head>
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=35dde2f296a97b5ad171e7beb3bfb02c&libraries=services"></script>
</head>

<script>

    function go() {

        const full_address = document.getElementById('address').value;
        serach(full_address)


    }

    function serach(address) {
        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
        mapOption = {
            center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
            level: 3 // 지도의 확대 레벨
        };

    // 지도를 생성합니다    
    var map = new kakao.maps.Map(mapContainer, mapOption);

    // 주소-좌표 변환 객체를 생성합니다
    var geocoder = new kakao.maps.services.Geocoder();
        // 주소로 좌표를 검색합니다
        geocoder.addressSearch(address, function (result, status) {

            // 정상적으로 검색이 완료됐으면 
            if (status === kakao.maps.services.Status.OK) {

                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                
                
                getAddr(coords.getLat(),coords.getLng())


                // 결과값으로 받은 위치를 마커로 표시합니다
                var marker = new kakao.maps.Marker({
                    map: map,
                    position: coords
                });

                // 인포윈도우로 장소에 대한 설명을 표시합니다
                var infowindow = new kakao.maps.InfoWindow({
                    content: `<div style="width:150px;text-align:center;padding:6px 0;">${$('#name').val()}</div>`
                });
                infowindow.open(map, marker);

                // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
                map.setCenter(coords);
            }
        });
    }
    function getAddr(lat, lng) {
            let geocoder = new kakao.maps.services.Geocoder();

            let coord = new kakao.maps.LatLng(lat, lng);
            let callback = function (result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    console.log(result)
                    // a=구
                    let a = result[0].address.address_name
                   
                    //b=지번
                    let b = result[0].road_address.address_name
                    
                    //c=도로명
                    let c = result[0].address.region_2depth_name
                    //d=지역
                    let d = result[0].address.region_1depth_name

                    if(a != '' && b != '' && c != ''){
                        $('#address1').val(d)
                        $('#address1-1').val(a)
                        $('#address1-2').val(b)
                        $('#address2').val(c)
                        $('#address3-lat').val(lat)
                        $('#address3-lng').val(lng)
                    }


                }
            }
            geocoder.coord2Address(coord.getLng(), coord.getLat(), callback);
        }
</script>


<body>

    <div style="margin-top:5px ;"></div>

    <label for="type">타입</label>
    <br>
    <select name="type" id="type" style="width: 500px;height: 30px; margin-top: 5px; margin-bottom: 5px;">
        <option value="none"> </option>
        <option value="hospital">병원</option>
        <option value="drugstore">약국</option>
        <option value="playground">노인정</option>
        <option value="welfare">복지회관</option>
        <option value="Community">주민센터</option>




    </select>

    <br>
    <label for="name" style="width: 100px;">이름</label>
    <br>
    <input type="text" id="name" style="width: 500px;height: 30px; margin-top: 10px;">

    <br>
    <label for="number" style="width: 100px;">전화번호</label>
    <br>
    <input type="text" id="number" style="width: 500px;height: 30px; margin-top: 5px;">

    <br>
    <label for="address" style="width: 100px;">주소</label>
    <br>
    <input type="text" id="address" onkeyup="go()" style="width: 500px;height: 30px; margin-top: 5px;">
    <br>
    <label for="address1" style="width: 100px;">지역</label>
    <br>
    <input type="text" id="address1" style="width: 500px; background-color:#F5F5F5;height: 30px; margin-top: 5px;"
        readonly>

        <br>
    <br>
    <label for="address2" style="width: 100px;">구</label>
    <br>
    <input type="text" id="address2" style="width: 500px; background-color:#F5F5F5;height: 30px; margin-top: 5px;"
        readonly>
        
        <br>
        <label for="address1-1" style="width: 100px;">지번</label>
        <br>
        <input type="text" id="address1-1" style="width: 500px; background-color:#F5F5F5;height: 30px; margin-top: 5px;"
            readonly>

            <br>
    <label for="address1-2" style="width: 100px;">도로명</label>
    <br>
    <input type="text" id="address1-2" style="width: 500px; background-color:#F5F5F5;height: 30px; margin-top: 5px;"
        readonly>

    <br>
    <label for="address3">위도경도</label>
    <br>
    <input type="text" id="address3-lat" style="width: 250; background-color:#F5F5F5;height: 30px; margin-top: 5px;"
        readonly>
        <input type="text" id="address3-lng" style="width: 250; background-color:#F5F5F5;height: 30px; margin-top: 5px;"
        readonly>



    <br>
    <button style="width: 80%; height: 30px; margin-top: 5px">
        저장
    </button>
    <br>
    <p style="margin-top:12px">
        <em class="link">
            <a href="javascript:void(0);"
                onclick="window.open('http://fiy.daum.net/fiy/map/CsGeneral.daum', '_blank', 'width=981, height=650')">
                혹시 주소 결과가 잘못 나오는 경우에는 여기에 제보해주세요.
            </a>
        </em>
    </p>
    <div id="map" style="width:100%;height:350px;"></div>


</body>

</html>